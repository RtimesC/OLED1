# 硬件连接说明

本文档详细说明了 OLED1 项目的硬件连接方式和电路配置。

## 目录

- [系统概述](#系统概述)
- [STM32 引脚定义](#stm32-引脚定义)
- [OLED 模块连接](#oled-模块连接)
- [LED 连接电路](#led-连接电路)
- [按键连接电路](#按键连接电路)
- [完整连接示意图](#完整连接示意图)
- [硬件清单](#硬件清单)
- [连接注意事项](#连接注意事项)

---

## 系统概述

本项目基于 STM32F10x 系列微控制器，连接以下外设：

- **OLED 显示屏**: 0.96 寸 128x64 分辨率，SSD1306 控制器，I2C 接口
- **LED 指示灯**: 2 个 LED，用于状态指示
- **按键**: 2 个按键，用于用户输入

### 主要通信接口

- **I2C**: 用于 OLED 通信
- **GPIO**: 用于 LED 和按键控制

---

## STM32 引脚定义

### OLED I2C 接口

| 功能 | STM32 引脚 | 说明 |
|------|-----------|------|
| SCL (时钟线) | PB8 | I2C1_SCL |
| SDA (数据线) | PB9 | I2C1_SDA |

**I2C 配置参数**:
- 速度: 400kHz (Fast Mode)
- 地址位: 7-bit
- OLED 地址: 0x78 (写) / 0x79 (读)

### LED 引脚

| LED | STM32 引脚 | 说明 |
|-----|-----------|------|
| LED1 | PA1 | 通用推挽输出 |
| LED2 | PA2 | 通用推挽输出 |

**GPIO 配置**:
- 模式: 推挽输出
- 速度: 50MHz
- 初始状态: 低电平（LED 熄灭）

### 按键引脚

| 按键 | STM32 引脚 | 说明 |
|------|-----------|------|
| KEY1 | PB12 | 上拉输入 |
| KEY2 | PB13 | 上拉输入 |

**GPIO 配置**:
- 模式: 上拉输入
- 触发方式: 低电平有效（按下为低）

---

## OLED 模块连接

### 接线图

```
OLED Module        STM32F103
┌─────────────┐   ┌──────────────┐
│             │   │              │
│  GND  ──────┼───┤ GND          │
│  VCC  ──────┼───┤ 3.3V/5V      │
│  SCL  ──────┼───┤ PB8 (SCL)    │
│  SDA  ──────┼───┤ PB9 (SDA)    │
│             │   │              │
└─────────────┘   └──────────────┘
```

### OLED 模块规格

- **型号**: 0.96 寸 OLED
- **控制器**: SSD1306
- **分辨率**: 128 x 64 像素
- **接口**: I2C (4 线)
- **工作电压**: 3.3V - 5V
- **显示颜色**: 单色（白色/蓝色/黄蓝双色）

### I2C 通信参数

```c
// I2C 配置
#define OLED_I2C                I2C1
#define OLED_I2C_CLK            RCC_APB1Periph_I2C1
#define OLED_I2C_GPIO_CLK       RCC_APB2Periph_GPIOB

#define OLED_I2C_SCL_PIN        GPIO_Pin_8
#define OLED_I2C_SDA_PIN        GPIO_Pin_9
#define OLED_I2C_GPIO_PORT      GPIOB

#define OLED_ADDRESS            0x78    // OLED I2C 地址
```

### 连接步骤

1. **电源连接**
   - OLED 的 VCC 连接到 STM32 的 3.3V 或 5V
   - OLED 的 GND 连接到 STM32 的 GND

2. **I2C 信号线连接**
   - OLED 的 SCL 连接到 STM32 的 PB8
   - OLED 的 SDA 连接到 STM32 的 PB9

3. **注意事项**
   - I2C 总线需要上拉电阻（一般模块已内置）
   - 如果使用 5V 供电，确认 OLED 模块支持 5V
   - 建议使用 3.3V 供电以保护 STM32 I/O

---

## LED 连接电路

### 电路图

```
        STM32 GPIO               LED
        
PA1 ────┬──────────┐
        │  220Ω    │
        └─[===]────┤>├────┐
                   LED1   │
                         GND

PA2 ────┬──────────┐
        │  220Ω    │
        └─[===]────┤>├────┐
                   LED2   │
                         GND
```

### 元件参数

| 元件 | 参数 | 说明 |
|------|------|------|
| LED | 红色/绿色 | 普通发光二极管 |
| 限流电阻 | 220Ω - 1kΩ | 根据 LED 类型调整 |

### 连接说明

**LED1 连接**:
1. STM32 的 PA1 连接到限流电阻（220Ω）
2. 电阻另一端连接到 LED 正极（长脚）
3. LED 负极（短脚）连接到 GND

**LED2 连接**:
1. STM32 的 PA2 连接到限流电阻（220Ω）
2. 电阻另一端连接到 LED 正极（长脚）
3. LED 负极（短脚）连接到 GND

### 控制逻辑

- **高电平 (3.3V)**: LED 点亮
- **低电平 (0V)**: LED 熄灭

---

## 按键连接电路

### 电路图

```
        3.3V
         │
         │ 10kΩ
         └───┬───── PB12 (KEY1)
             │
          [按键]
             │
            GND

        3.3V
         │
         │ 10kΩ
         └───┬───── PB13 (KEY2)
             │
          [按键]
             │
            GND
```

### 元件参数

| 元件 | 参数 | 说明 |
|------|------|------|
| 按键 | 轻触开关 | 常开型 |
| 上拉电阻 | 10kΩ | 可选，STM32 内置上拉 |

### 连接说明

**KEY1 连接**:
1. PB12 通过上拉电阻（或 STM32 内部上拉）连接到 3.3V
2. PB12 通过按键连接到 GND
3. 按键未按下时，PB12 为高电平
4. 按键按下时，PB12 为低电平

**KEY2 连接**:
1. PB13 通过上拉电阻（或 STM32 内部上拉）连接到 3.3V
2. PB13 通过按键连接到 GND
3. 按键未按下时，PB13 为高电平
4. 按键按下时，PB13 为低电平

### 检测逻辑

- **高电平**: 按键未按下
- **低电平**: 按键按下

### 消抖处理

代码中已实现软件消抖，通过延时和多次采样来过滤按键抖动。

---

## 完整连接示意图

```
                        STM32F103C8T6
                    ┌──────────────────┐
                    │                  │
    OLED ────── PB8 │ I2C1_SCL         │
         ────── PB9 │ I2C1_SDA         │
                    │                  │
    LED1 ────── PA1 │ GPIO             │
    LED2 ────── PA2 │ GPIO             │
                    │                  │
    KEY1 ────── PB12│ GPIO             │
    KEY2 ────── PB13│ GPIO             │
                    │                  │
            ─── GND │ GND              │
         ─── 3.3V   │ 3.3V             │
                    │                  │
                    └──────────────────┘
```

---

## 硬件清单

### 必需元件

| 序号 | 元件名称 | 数量 | 规格 | 备注 |
|------|---------|------|------|------|
| 1 | STM32F103C8T6 最小系统板 | 1 | - | 主控制器 |
| 2 | 0.96寸 OLED 显示屏 | 1 | SSD1306, I2C | 显示模块 |
| 3 | LED | 2 | 3mm/5mm 红色或绿色 | 状态指示 |
| 4 | 电阻 | 2 | 220Ω - 1kΩ | LED 限流 |
| 5 | 轻触开关 | 2 | 6x6mm | 按键输入 |
| 6 | 杜邦线 | 若干 | 公对母 | 连接线 |
| 7 | 面包板 | 1 | - | 可选，用于原型搭建 |

### 可选元件

| 序号 | 元件名称 | 数量 | 规格 | 备注 |
|------|---------|------|------|------|
| 1 | 上拉电阻 | 2 | 10kΩ | 按键上拉，可用内部上拉代替 |
| 2 | 电容 | 2 | 0.1μF | I2C 总线滤波 |
| 3 | ST-Link V2 | 1 | - | 程序下载和调试 |

---

## 连接注意事项

### 电源

1. **电压匹配**
   - STM32 工作电压: 3.3V
   - OLED 可工作在 3.3V 或 5V
   - 建议统一使用 3.3V 供电

2. **电源稳定性**
   - 使用稳压电源
   - 在电源引脚附近添加去耦电容（0.1μF）

### I2C 总线

1. **上拉电阻**
   - I2C 总线需要上拉电阻（通常 4.7kΩ）
   - 大多数 OLED 模块已内置上拉电阻
   - 如果通信不稳定，可尝试添加或更换上拉电阻

2. **线长限制**
   - I2C 总线尽量短，建议不超过 20cm
   - 过长会导致信号完整性问题

3. **地址冲突**
   - 确认 OLED I2C 地址（通常为 0x78 或 0x3C）
   - 同一总线上不能有相同地址的设备

### LED

1. **限流电阻**
   - 必须串联限流电阻，保护 LED 和 GPIO
   - 电阻值根据 LED 类型选择（一般 220Ω - 1kΩ）

2. **电流限制**
   - STM32 GPIO 输出电流不应超过 25mA
   - 建议 LED 工作电流在 10-20mA

### 按键

1. **消抖**
   - 硬件消抖: 可添加 RC 滤波电路
   - 软件消抖: 代码中已实现

2. **上拉/下拉**
   - 使用 STM32 内部上拉电阻即可
   - 如需要，可外接 10kΩ 上拉电阻

### 一般注意事项

1. **焊接质量**
   - 确保焊点牢固，无虚焊
   - 检查是否有短路

2. **连接检查**
   - 上电前仔细检查所有连接
   - 使用万用表测试通断
   - 确认电源极性正确

3. **静电防护**
   - STM32 和 OLED 对静电敏感
   - 操作前做好静电防护措施

4. **首次测试**
   - 先不连接外设，单独测试 STM32
   - 逐一连接外设并测试
   - 出现问题时更容易定位

---

## 电气规格

### STM32F103C8T6

- **工作电压**: 2.0V - 3.6V（典型 3.3V）
- **GPIO 输出电流**: 最大 25mA
- **I2C 速度**: 最高 400kHz (Fast Mode)

### OLED SSD1306

- **工作电压**: 3.3V - 5.5V
- **工作电流**: 20mA (典型)
- **I2C 地址**: 0x78 / 0x3C (取决于 SA0 引脚)

---

## 故障排查

### OLED 不显示

1. 检查电源连接
2. 确认 I2C 线序（SCL/SDA 不要接反）
3. 使用示波器或逻辑分析仪检查 I2C 信号
4. 确认 I2C 地址是否正确
5. 检查上拉电阻

### LED 不亮

1. 检查 LED 极性（正负极）
2. 确认限流电阻是否连接
3. 测量 GPIO 输出电压
4. 检查 LED 是否损坏（用万用表测试）

### 按键无响应

1. 检查按键是否良好接触
2. 确认 GPIO 配置为输入上拉
3. 测量按键按下时的电压变化
4. 检查是否需要消抖处理

---

## 扩展功能

如果需要添加更多外设，可以使用以下未使用的 STM32 引脚：

- **可用 GPIO**: PA0, PA3-PA15, PB0-PB11, PB14-PB15
- **可用 I2C**: I2C2 (PB10, PB11)
- **可用 SPI**: SPI1 (PA5-PA7), SPI2 (PB13-PB15)
- **可用 UART**: USART1-USART3

---

## 参考资料

- [STM32F103C8T6 数据手册](https://www.st.com/resource/en/datasheet/stm32f103c8.pdf)
- [SSD1306 OLED 控制器手册](https://cdn-shop.adafruit.com/datasheets/SSD1306.pdf)
- [I2C 总线规范](https://www.nxp.com/docs/en/user-guide/UM10204.pdf)

---

如有问题，请访问项目 GitHub 页面提交 Issue:
https://github.com/RtimesC/OLED1/issues
