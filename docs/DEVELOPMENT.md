# å¼€å‘æŒ‡å—

æœ¬æ–‡æ¡£ä¸ºå¼€å‘è€…æä¾›è¯¦ç»†çš„å¼€å‘ç¯å¢ƒæ­å»ºã€é¡¹ç›®é…ç½®å’Œå¼€å‘æŠ€å·§è¯´æ˜ã€‚

## ç›®å½•

- [å¼€å‘ç¯å¢ƒæ­å»º](#å¼€å‘ç¯å¢ƒæ­å»º)
- [Keil é¡¹ç›®é…ç½®](#keil-é¡¹ç›®é…ç½®)
- [ç¼–è¯‘å’Œè°ƒè¯•](#ç¼–è¯‘å’Œè°ƒè¯•)
- [ä»£ç å¼€å‘è§„èŒƒ](#ä»£ç å¼€å‘è§„èŒƒ)
- [è°ƒè¯•æŠ€å·§](#è°ƒè¯•æŠ€å·§)
- [å¸¸è§é—®é¢˜è§£å†³](#å¸¸è§é—®é¢˜è§£å†³)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)

---

## å¼€å‘ç¯å¢ƒæ­å»º

### å¿…éœ€è½¯ä»¶

#### 1. Keil ÂµVision 5

**ä¸‹è½½åœ°å€**: http://www.keil.com/download/product/

**å®‰è£…æ­¥éª¤**:
1. ä¸‹è½½ MDK-ARMï¼ˆKeil ÂµVisionï¼‰å®‰è£…åŒ…
2. è¿è¡Œå®‰è£…ç¨‹åºï¼Œé€‰æ‹©å®‰è£…è·¯å¾„
3. å®Œæˆå®‰è£…åï¼Œå®‰è£… STM32F1xx Device Family Pack

**æ¿€æ´»è®¸å¯è¯**:
- ä½¿ç”¨è®¸å¯è¯æ–‡ä»¶æˆ–åœ¨çº¿æ¿€æ´»
- æ•™è‚²ç‰ˆå’Œè¯„ä¼°ç‰ˆæœ‰ä»£ç å¤§å°é™åˆ¶ï¼ˆ32KBï¼‰

#### 2. STM32 ST-Link Utility

**ä¸‹è½½åœ°å€**: https://www.st.com/en/development-tools/stsw-link004.html

**åŠŸèƒ½**:
- ç¨‹åºä¸‹è½½
- Flash è¯»å†™
- å†…å­˜æŸ¥çœ‹
- å›ºä»¶å‡çº§

#### 3. Git

**ä¸‹è½½åœ°å€**: https://git-scm.com/downloads

ç”¨äºç‰ˆæœ¬æ§åˆ¶å’Œåä½œå¼€å‘ã€‚

### å¯é€‰è½¯ä»¶

#### 1. STM32CubeMX

é…ç½® STM32 å¤–è®¾å’Œç”Ÿæˆåˆå§‹åŒ–ä»£ç ã€‚

#### 2. Serial Port Monitor

è°ƒè¯•ä¸²å£é€šä¿¡ï¼ˆå¦‚æœé¡¹ç›®ä½¿ç”¨ UARTï¼‰ã€‚

#### 3. Logic Analyzer Software

åˆ†æ I2Cã€SPI ç­‰æ€»çº¿é€šä¿¡ã€‚

---

## Keil é¡¹ç›®é…ç½®

### æ‰“å¼€é¡¹ç›®

1. å¯åŠ¨ Keil ÂµVision
2. ç‚¹å‡» `Project` -> `Open Project`
3. é€‰æ‹© `Project.uvprojx` æ–‡ä»¶
4. ç­‰å¾…é¡¹ç›®åŠ è½½å®Œæˆ

### é¡¹ç›®ç»“æ„

```
Project.uvprojx (Keil é¡¹ç›®æ–‡ä»¶)
â”œâ”€â”€ Target 1
â”‚   â”œâ”€â”€ Source Group 1 (ç”¨æˆ·ä»£ç )
â”‚   â”‚   â””â”€â”€ main.c
â”‚   â”œâ”€â”€ Hardware (ç¡¬ä»¶é©±åŠ¨)
â”‚   â”‚   â”œâ”€â”€ LED.c
â”‚   â”‚   â”œâ”€â”€ Key.c
â”‚   â”‚   â””â”€â”€ OLED.c
â”‚   â”œâ”€â”€ System (ç³»ç»Ÿæ–‡ä»¶)
â”‚   â”œâ”€â”€ Library (STM32 æ ‡å‡†åº“)
â”‚   â””â”€â”€ Start (å¯åŠ¨æ–‡ä»¶)
```

### ç›®æ ‡é…ç½®

#### 1. é€‰æ‹©ç›®æ ‡èŠ¯ç‰‡

1. ç‚¹å‡» `Project` -> `Options for Target...` (Alt+F7)
2. åœ¨ `Device` é€‰é¡¹å¡ä¸­é€‰æ‹©èŠ¯ç‰‡å‹å·ï¼ˆä¾‹å¦‚ STM32F103C8ï¼‰
3. ç‚¹å‡» `OK` ä¿å­˜

#### 2. C/C++ ç¼–è¯‘é€‰é¡¹

**è·¯å¾„**: `Options for Target` -> `C/C++`

```
Include Paths:
./User
./Hardware
./System
./Library/inc
```

**é¢„å¤„ç†å™¨å®šä¹‰**:
```
USE_STDPERIPH_DRIVER
STM32F10X_MD
```

**ä¼˜åŒ–ç­‰çº§**:
- Debug æ¨¡å¼: `-O0` (æ— ä¼˜åŒ–)
- Release æ¨¡å¼: `-O2` æˆ– `-O3`

#### 3. è°ƒè¯•é…ç½®

**è·¯å¾„**: `Options for Target` -> `Debug`

1. é€‰æ‹©è°ƒè¯•å™¨: `ST-Link Debugger`
2. ç‚¹å‡» `Settings` é…ç½® ST-Link
   - Connect: `Normal`
   - Port: `SW` (Serial Wire)
   - é¢‘ç‡: 4MHz

#### 4. ä¸‹è½½é…ç½®

**è·¯å¾„**: `Options for Target` -> `Utilities`

1. é€‰æ‹© `Use Target Driver for Flash Programming`
2. é€‰æ‹© `ST-Link Debugger`
3. ç‚¹å‡» `Settings` é…ç½®ä¸‹è½½é€‰é¡¹
   - Programming Algorithm: STM32F10x Medium Density
   - Reset and Run: å‹¾é€‰ï¼ˆä¸‹è½½åè‡ªåŠ¨è¿è¡Œï¼‰

---

## ç¼–è¯‘å’Œè°ƒè¯•

### ç¼–è¯‘é¡¹ç›®

#### 1. ç¼–è¯‘å•ä¸ªæ–‡ä»¶

- å¿«æ·é”®: `Ctrl+F7`
- èœå•: `Project` -> `Compile`

#### 2. æ„å»ºæ•´ä¸ªé¡¹ç›®

- å¿«æ·é”®: `F7`
- èœå•: `Project` -> `Build Target`

#### 3. é‡æ–°æ„å»º

- å¿«æ·é”®: `F7` (åœ¨å…¨éƒ¨æ¸…é™¤å)
- èœå•: `Project` -> `Rebuild all target files`

### ä¸‹è½½ç¨‹åº

#### 1. ä¸‹è½½åˆ° Flash

- å¿«æ·é”®: `F8`
- èœå•: `Flash` -> `Download`

#### 2. è¿æ¥æ£€æŸ¥

ä¸‹è½½å‰ç¡®ä¿ï¼š
- ST-Link å·²è¿æ¥åˆ° PC
- ST-Link å·²è¿æ¥åˆ°ç›®æ ‡æ¿
- ç›®æ ‡æ¿å·²ä¾›ç”µ

### è°ƒè¯•ç¨‹åº

#### 1. å¯åŠ¨è°ƒè¯•ä¼šè¯

- å¿«æ·é”®: `Ctrl+F5`
- èœå•: `Debug` -> `Start/Stop Debug Session`

#### 2. è°ƒè¯•æ§åˆ¶

| åŠŸèƒ½ | å¿«æ·é”® | è¯´æ˜ |
|------|--------|------|
| è¿è¡Œ | F5 | å…¨é€Ÿè¿è¡Œç¨‹åº |
| åœæ­¢ | Ctrl+F5 | åœæ­¢è°ƒè¯• |
| å•æ­¥è¿›å…¥ | F11 | è¿›å…¥å‡½æ•°å†…éƒ¨ |
| å•æ­¥è·³è¿‡ | F10 | è·³è¿‡å‡½æ•°è°ƒç”¨ |
| å•æ­¥è·³å‡º | Ctrl+F11 | è·³å‡ºå½“å‰å‡½æ•° |
| è¿è¡Œåˆ°å…‰æ ‡ | Ctrl+F10 | è¿è¡Œåˆ°å…‰æ ‡ä½ç½® |

#### 3. æ–­ç‚¹è®¾ç½®

- ç‚¹å‡»è¡Œå·å·¦ä¾§è®¾ç½®æ–­ç‚¹
- å¿«æ·é”®: `F9` åˆ‡æ¢æ–­ç‚¹
- æ¡ä»¶æ–­ç‚¹: å³é”®æ–­ç‚¹ -> `Breakpoint Properties`

#### 4. è§‚å¯Ÿå˜é‡

**Watch çª—å£**:
- æ·»åŠ å˜é‡åˆ° Watch çª—å£å®æ—¶è§‚å¯Ÿ
- æ”¯æŒè¡¨è¾¾å¼æ±‚å€¼

**Memory çª—å£**:
- æŸ¥çœ‹å†…å­˜å†…å®¹
- èœå•: `View` -> `Memory Windows`

**Peripheral çª—å£**:
- æŸ¥çœ‹å’Œä¿®æ”¹å¤–è®¾å¯„å­˜å™¨
- èœå•: `View` -> `Peripherals`

---

## ä»£ç å¼€å‘è§„èŒƒ

### æ–‡ä»¶ç»„ç»‡

#### å¤´æ–‡ä»¶ç»“æ„

```c
/**
  ******************************************************************************
  * @file    æ–‡ä»¶å.h
  * @author  ä½œè€…å
  * @version V1.0.0
  * @date    æ—¥æœŸ
  * @brief   ç®€è¦è¯´æ˜
  ******************************************************************************
  */

#ifndef __æ–‡ä»¶å_H
#define __æ–‡ä»¶å_H

/* Includes ------------------------------------------------------------------*/
#include "stm32f10x.h"

/* Exported types ------------------------------------------------------------*/

/* Exported constants --------------------------------------------------------*/

/* Exported macro ------------------------------------------------------------*/

/* Exported functions ------------------------------------------------------- */
void Function_Name(void);

#endif /* __æ–‡ä»¶å_H */
```

#### æºæ–‡ä»¶ç»“æ„

```c
/**
  ******************************************************************************
  * @file    æ–‡ä»¶å.c
  * @author  ä½œè€…å
  * @version V1.0.0
  * @date    æ—¥æœŸ
  * @brief   ç®€è¦è¯´æ˜
  ******************************************************************************
  */

/* Includes ------------------------------------------------------------------*/
#include "æ–‡ä»¶å.h"

/* Private typedef -----------------------------------------------------------*/

/* Private define ------------------------------------------------------------*/

/* Private macro -------------------------------------------------------------*/

/* Private variables ---------------------------------------------------------*/

/* Private function prototypes -----------------------------------------------*/

/* Private functions ---------------------------------------------------------*/

/**
  * @brief  å‡½æ•°ç®€è¦è¯´æ˜
  * @param  å‚æ•°è¯´æ˜
  * @retval è¿”å›å€¼è¯´æ˜
  */
void Function_Name(void)
{
    // å‡½æ•°å®ç°
}
```

### å‘½åè§„èŒƒ

è¯¦è§ [CONTRIBUTING.md](../CONTRIBUTING.md) ä¸­çš„ä»£ç è§„èŒƒéƒ¨åˆ†ã€‚

---

## è°ƒè¯•æŠ€å·§

### 1. ä½¿ç”¨ printf è°ƒè¯•

#### é‡å®šå‘ printf åˆ° OLED

```c
#include "OLED.h"
#include <stdio.h>

// é‡å®šå‘ printf
int fputc(int ch, FILE *f)
{
    static uint8_t line = 1;
    static uint8_t col = 1;
    
    if (ch == '\n')
    {
        line++;
        col = 1;
        if (line > 4) line = 1;
    }
    else
    {
        OLED_ShowChar(line, col, ch);
        col++;
        if (col > 16)
        {
            line++;
            col = 1;
            if (line > 4) line = 1;
        }
    }
    
    return ch;
}

// ä½¿ç”¨
printf("Value: %d\n", value);
```

### 2. ä½¿ç”¨æ–­è¨€

```c
#include <assert.h>

void Function(uint8_t *ptr)
{
    assert(ptr != NULL);  // æ£€æŸ¥æŒ‡é’ˆéç©º
    // å‡½æ•°å®ç°
}
```

### 3. LED æŒ‡ç¤ºè°ƒè¯•

```c
// ä½¿ç”¨ LED æŒ‡ç¤ºç¨‹åºè¿è¡Œåˆ°æŸä¸ªä½ç½®
LED1_ON();  // åˆ°è¾¾æ£€æŸ¥ç‚¹ 1
// ...
LED1_OFF();
LED2_ON();  // åˆ°è¾¾æ£€æŸ¥ç‚¹ 2
```

### 4. I2C æ€»çº¿è°ƒè¯•

```c
// æ£€æŸ¥ I2C å¿™çŠ¶æ€
while (I2C_GetFlagStatus(I2C1, I2C_FLAG_BUSY));

// æ£€æŸ¥ I2C äº‹ä»¶
while (!I2C_CheckEvent(I2C1, I2C_EVENT_MASTER_MODE_SELECT));
```

### 5. é€»è¾‘åˆ†æä»ª

ä½¿ç”¨é€»è¾‘åˆ†æä»ªæ•è· I2C é€šä¿¡:
- è¿æ¥é€šé“ 0 åˆ° SCL
- è¿æ¥é€šé“ 1 åˆ° SDA
- è®¾ç½®åè®®è§£ç ä¸º I2C
- åˆ†æé€šä¿¡æ—¶åºå’Œæ•°æ®

---

## å¸¸è§é—®é¢˜è§£å†³

### ç¼–è¯‘é—®é¢˜

#### 1. "cannot open source input file"

**åŸå› **: æ‰¾ä¸åˆ°å¤´æ–‡ä»¶

**è§£å†³**:
- æ£€æŸ¥ Include Paths é…ç½®
- ç¡®è®¤æ–‡ä»¶è·¯å¾„æ­£ç¡®
- æ£€æŸ¥æ–‡ä»¶åå¤§å°å†™ï¼ˆLinux åŒºåˆ†ï¼‰

#### 2. "undefined symbol"

**åŸå› **: å‡½æ•°æœªå®šä¹‰æˆ–æœªé“¾æ¥

**è§£å†³**:
- æ£€æŸ¥å‡½æ•°æ˜¯å¦å®ç°
- ç¡®è®¤æºæ–‡ä»¶å·²æ·»åŠ åˆ°é¡¹ç›®
- æ£€æŸ¥å‡½æ•°å£°æ˜å’Œå®šä¹‰æ˜¯å¦åŒ¹é…

#### 3. Flash ç©ºé—´ä¸è¶³

**åŸå› **: ç¨‹åºå¤ªå¤§è¶…å‡º Flash å®¹é‡

**è§£å†³**:
- æé«˜ç¼–è¯‘ä¼˜åŒ–ç­‰çº§
- ç§»é™¤ä¸å¿…è¦çš„ä»£ç 
- ä½¿ç”¨æ›´å¤§å®¹é‡çš„èŠ¯ç‰‡

### ä¸‹è½½é—®é¢˜

#### 1. "No target connected"

**åŸå› **: ST-Link æœªè¿æ¥æˆ–æœªè¯†åˆ«

**è§£å†³**:
- æ£€æŸ¥ USB è¿æ¥
- é‡æ–°æ’æ‹” ST-Link
- æ›´æ–° ST-Link é©±åŠ¨ç¨‹åº
- æ£€æŸ¥ SWDIO/SWCLK è¿æ¥

#### 2. "Error: Flash Download failed"

**åŸå› **: Flash ä¸‹è½½å¤±è´¥

**è§£å†³**:
- æ£€æŸ¥ç›®æ ‡æ¿ä¾›ç”µ
- ç¡®è®¤èŠ¯ç‰‡å‹å·é€‰æ‹©æ­£ç¡®
- å°è¯•å…¨ç‰‡æ“¦é™¤åå†ä¸‹è½½
- é™ä½ SWD æ—¶é’Ÿé¢‘ç‡

### è¿è¡Œé—®é¢˜

#### 1. OLED ä¸æ˜¾ç¤º

**å‚è€ƒ**: [docs/HARDWARE.md](HARDWARE.md) çš„æ•…éšœæ’æŸ¥éƒ¨åˆ†

#### 2. ç¨‹åºè¿è¡Œå¼‚å¸¸

**å¯èƒ½åŸå› **:
- ç¡¬ä»¶æ•…éšœ (HardFault)
- æ ˆæº¢å‡º
- æœªåˆå§‹åŒ–çš„å˜é‡
- æŒ‡é’ˆé”™è¯¯

**è°ƒè¯•æ–¹æ³•**:
- ä½¿ç”¨è°ƒè¯•å™¨å®šä½ HardFault ä½ç½®
- å¢åŠ æ ˆå¤§å°ï¼ˆåœ¨å¯åŠ¨æ–‡ä»¶ä¸­é…ç½®ï¼‰
- æ£€æŸ¥æ•°ç»„è¶Šç•Œ
- ä½¿ç”¨é™æ€åˆ†æå·¥å…·

#### 3. I2C é€šä¿¡å¤±è´¥

**æ£€æŸ¥**:
- I2C åœ°å€æ˜¯å¦æ­£ç¡®
- ä¸Šæ‹‰ç”µé˜»æ˜¯å¦å­˜åœ¨
- æ—¶åºæ˜¯å¦æ­£ç¡®
- ä½¿ç”¨é€»è¾‘åˆ†æä»ªæŸ¥çœ‹æ³¢å½¢

---

## æ€§èƒ½ä¼˜åŒ–

### 1. ä»£ç ä¼˜åŒ–

#### ç¼–è¯‘å™¨ä¼˜åŒ–

åœ¨ `Options for Target` -> `C/C++` -> `Optimization` ä¸­é€‰æ‹©ï¼š
- `-O0`: æ— ä¼˜åŒ–ï¼Œè°ƒè¯•ç”¨
- `-O1`: åŸºç¡€ä¼˜åŒ–
- `-O2`: é«˜çº§ä¼˜åŒ–ï¼ˆæ¨èï¼‰
- `-O3`: æœ€é«˜ä¼˜åŒ–
- `-Os`: ä¼˜åŒ–ä»£ç å¤§å°

#### å†…è”å‡½æ•°

```c
// å¯¹äºé¢‘ç¹è°ƒç”¨çš„å°å‡½æ•°ï¼Œä½¿ç”¨ inline
static inline void GPIO_SetBit(GPIO_TypeDef* GPIOx, uint16_t GPIO_Pin)
{
    GPIOx->BSRR = GPIO_Pin;
}
```

### 2. I2C é€Ÿåº¦ä¼˜åŒ–

```c
// æé«˜ I2C æ—¶é’Ÿé€Ÿåº¦åˆ° 400kHz
I2C_InitStructure.I2C_ClockSpeed = 400000;

// æˆ–ä½¿ç”¨ DMA ä¼ è¾“å¤§é‡æ•°æ®
```

### 3. æ˜¾ç¤ºä¼˜åŒ–

```c
// æ‰¹é‡å†™å…¥æ•°æ®è€Œä¸æ˜¯å•å­—èŠ‚å†™å…¥
OLED_WriteData_Multi(buffer, length);

// åªæ›´æ–°éœ€è¦æ”¹å˜çš„åŒºåŸŸï¼Œè€Œä¸æ˜¯æ•´å±åˆ·æ–°
```

### 4. å†…å­˜ä¼˜åŒ–

```c
// ä½¿ç”¨åˆé€‚çš„æ•°æ®ç±»å‹
uint8_t counter;     // 0-255ï¼Œä½¿ç”¨ uint8_t
uint16_t value;      // 0-65535ï¼Œä½¿ç”¨ uint16_t

// é¿å…ä¸å¿…è¦çš„å…¨å±€å˜é‡
static uint8_t buffer[128];  // ä½¿ç”¨ static é™åˆ¶ä½œç”¨åŸŸ

// ä½¿ç”¨ const å­˜å‚¨å¸¸é‡æ•°æ®åˆ° Flash
const uint8_t OLED_Font[] = {...};
```

---

## è¿›é˜¶å¼€å‘

### 1. æ·»åŠ æ–°çš„æ˜¾ç¤ºåŠŸèƒ½

ç¤ºä¾‹ï¼šæ·»åŠ ç”»ç‚¹åŠŸèƒ½

```c
/**
  * @brief  åœ¨ OLED ä¸Šç”»ä¸€ä¸ªç‚¹
  * @param  x: X åæ ‡ (0-127)
  * @param  y: Y åæ ‡ (0-63)
  * @retval None
  */
void OLED_DrawPoint(uint8_t x, uint8_t y)
{
    uint8_t page = y / 8;
    uint8_t bit = y % 8;
    
    OLED_SetCursor(page, x);
    OLED_WriteData(1 << bit);
}
```

### 2. æ·»åŠ ä¸­æ–‡æ˜¾ç¤º

éœ€è¦ï¼š
- ä¸­æ–‡å­—åº“ï¼ˆ16x16 æˆ–æ›´å¤§ï¼‰
- æ±‰å­—ç¼–ç è½¬æ¢
- æ˜¾ç¤ºå‡½æ•°å®ç°

### 3. æ·»åŠ å›¾å½¢ç•Œé¢

å¯ä»¥å®ç°ï¼š
- èœå•ç³»ç»Ÿ
- è¿›åº¦æ¡
- å›¾æ ‡æ˜¾ç¤º
- åŠ¨ç”»æ•ˆæœ

---

## ç‰ˆæœ¬æ§åˆ¶

### Git å·¥ä½œæµ

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/RtimesC/OLED1.git

# åˆ›å»ºç‰¹æ€§åˆ†æ”¯
git checkout -b feature/new-feature

# æäº¤æ›´æ”¹
git add .
git commit -m "feat: æ·»åŠ æ–°åŠŸèƒ½"

# æ¨é€åˆ°è¿œç¨‹
git push origin feature/new-feature
```

### .gitignore è¯´æ˜

é¡¹ç›®çš„ `.gitignore` å·²é…ç½®å¿½ç•¥ï¼š
- Keil ç¼–è¯‘è¾“å‡ºæ–‡ä»¶
- ç”¨æˆ·é…ç½®æ–‡ä»¶
- ä¸´æ—¶æ–‡ä»¶

---

## å‚è€ƒèµ„æ–™

### å®˜æ–¹æ–‡æ¡£

- [STM32F10x æ ‡å‡†å¤–è®¾åº“ç”¨æˆ·æ‰‹å†Œ](https://www.st.com/resource/en/user_manual/cd00246267-stm32f10xxx-flash-memory-microcontrollers-stmicroelectronics.pdf)
- [Keil ÂµVision ç”¨æˆ·æŒ‡å—](http://www.keil.com/support/man/docs/uv4/)
- [ARM Cortex-M3 æŠ€æœ¯å‚è€ƒæ‰‹å†Œ](https://developer.arm.com/documentation/ddi0337/e/)

### å­¦ä¹ èµ„æº

- [STM32 ä¸­æ–‡ç¤¾åŒº](http://www.stmcu.org.cn/)
- [STM32 å®˜æ–¹åŸ¹è®­èµ„æ–™](https://www.st.com/content/st_com/en/support/learning/stm32-education.html)

---

## æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰å¼€å‘ç›¸å…³é—®é¢˜ï¼Œè¯·ï¼š
- æŸ¥çœ‹ [å¸¸è§é—®é¢˜](https://github.com/RtimesC/OLED1/wiki/FAQ)
- æäº¤ [GitHub Issue](https://github.com/RtimesC/OLED1/issues)
- å‚ä¸ [è®¨è®ºåŒº](https://github.com/RtimesC/OLED1/discussions)

---

ç¥å¼€å‘é¡ºåˆ©ï¼ğŸš€
